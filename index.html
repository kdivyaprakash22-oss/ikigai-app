<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Discover your ikigai and live with purpose.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ikigai">
    <link rel="manifest" href="manifest.json">
    <title>Ikigai Journey - Find Your Purpose</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e0e0e0;
            --card-bg: #f8f9fa;
        }

        body.dark-mode {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --bg: #1a1a1a;
            --text: #ffffff;
            --text-light: #bbbbbb;
            --border: #333333;
            --card-bg: #2d2d2d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top));
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-bottom: env(safe-area-inset-bottom);
            color: var(--text);
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .theme-selector, .controls {
            display: flex;
            gap: 8px;
        }

        .theme-btn, .control-btn {
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body.dark-mode .theme-btn,
        body.dark-mode .control-btn {
            background: #333333;
            color: white;
        }

        .theme-btn:hover, .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 15px;
        }

        header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .nav-tab {
            padding: 10px 12px;
            background: white;
            border: none;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.85em;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        body.dark-mode .nav-tab {
            background: #333333;
            color: #667eea;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        .card {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            margin-bottom: 15px;
            color: var(--text);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        .card h3 {
            color: var(--text);
            margin: 15px 0 10px 0;
            font-size: 1em;
        }

        .activity-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: var(--text);
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9em;
            background: var(--card-bg);
            color: var(--text);
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 50px;
            resize: vertical;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            min-height: 44px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.75em;
            opacity: 0.9;
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .item-card {
            background: var(--card-bg);
            border-left: 4px solid var(--primary);
            padding: 12px;
            border-radius: 6px;
            transition: all 0.3s;
            color: var(--text);
        }

        .item-card:hover {
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
        }

        .item-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
            font-size: 0.95em;
        }

        .item-meta {
            color: var(--text-light);
            font-size: 0.8em;
        }

        .success-message {
            background: #e8f5e9;
            border: 2px solid #51cf66;
            color: #2d6a2d;
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
        }

        body.dark-mode .success-message {
            background: #1b5e20;
            color: #81c784;
            border-color: #51cf66;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .share-twitter { background: #1DA1F2; color: white; }
        .share-facebook { background: #1877F2; color: white; }
        .share-linkedin { background: #0A66C2; color: white; }
        .share-whatsapp { background: #25D366; color: white; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            color: var(--text);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            float: right;
            color: var(--text);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 600px) {
            .activity-form {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 1.5em;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-controls">
            <header style="margin-bottom: 0; flex: 1;">
                <h1>üå∏ Ikigai Journey</h1>
            </header>
            <div class="controls">
                <div class="theme-selector">
                    <button class="theme-btn" title="Light Theme" onclick="setTheme('light')">‚òÄÔ∏è</button>
                    <button class="theme-btn" title="Dark Theme" onclick="setTheme('dark')">üåô</button>
                </div>
                <button class="control-btn" title="Export Data" onclick="exportData()">üíæ</button>
                <button class="control-btn" title="Settings" onclick="openSettings()">‚öôÔ∏è</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('discover')">üéØ Discover</button>
            <button class="nav-tab" onclick="switchTab('today')">üìÖ Activity</button>
            <button class="nav-tab" onclick="switchTab('nutrition')">üçΩÔ∏è Nutrition</button>
            <button class="nav-tab" onclick="switchTab('wellness')">üí™ Wellness</button>
            <button class="nav-tab" onclick="switchTab('analytics')">üìä Stats</button>
        </div>

        <!-- DISCOVER SECTION -->
        <div id="discover" class="section active">
            <div class="card">
                <h2>üå∏ Discover Your Ikigai</h2>

                <form id="ikigaiForm" onsubmit="submitIkigai(event)">
                    <div class="activity-form">
                        <div class="form-group">
                            <label for="love">‚ù§Ô∏è What do you LOVE?</label>
                            <textarea id="love" placeholder="Your passions..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="good">‚≠ê What are you GOOD AT?</label>
                            <textarea id="good" placeholder="Your talents..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="need">üåç What does WORLD NEED?</label>
                            <textarea id="need" placeholder="Your contribution..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="paid">üí∞ What can you be PAID FOR?</label>
                            <textarea id="paid" placeholder="Monetizable skills..." required></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">‚ú® Generate Ikigai</button>
                </form>

                <div id="ikigaiDiagram" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--border);">
                    <div class="success-message">
                        <strong>‚úÖ Your Ikigai Saved!</strong>
                        <div id="resultText" style="margin-top: 8px; font-size: 0.9em;"></div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-secondary" onclick="shareIkigai()">üì¢ Share Results</button>
                        <button class="btn-secondary" onclick="downloadIkigai()">üì• Download as Text</button>
                    </div>

                    <div class="share-buttons" id="shareButtons" style="display: none;">
                        <button class="share-btn share-twitter" onclick="shareOnTwitter()">ùïè Twitter</button>
                        <button class="share-btn share-facebook" onclick="shareOnFacebook()">f Facebook</button>
                        <button class="share-btn share-linkedin" onclick="shareOnLinkedIn()">in LinkedIn</button>
                        <button class="share-btn share-whatsapp" onclick="shareOnWhatsApp()">üí¨ WhatsApp</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIVITIES SECTION -->
        <div id="today" class="section">
            <div class="card">
                <h2>üìÖ Log Activities</h2>
                <div class="activity-form">
                    <div class="form-group">
                        <label for="activityName">Activity *</label>
                        <input type="text" id="activityName" placeholder="e.g., Programming" required>
                    </div>
                    <div class="form-group">
                        <label for="ikigaiCategory">Category *</label>
                        <select id="ikigaiCategory" required>
                            <option value="">Select...</option>
                            <option value="love">‚ù§Ô∏è Love</option>
                            <option value="good">‚≠ê Good</option>
                            <option value="need">üåç Need</option>
                            <option value="paid">üí∞ Paid</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="duration">Duration (min) *</label>
                        <input type="number" id="duration" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="flowState">Flow (1-10) *</label>
                        <input type="number" id="flowState" min="1" max="10" required>
                    </div>
                    <button class="btn-primary" onclick="addActivity()" style="grid-column: 1 / -1;">‚ûï Log Activity</button>
                </div>
                <h3>Today's Activities</h3>
                <div id="activityList" class="item-grid"></div>
            </div>
        </div>

        <!-- NUTRITION SECTION -->
        <div id="nutrition" class="section">
            <div class="card">
                <h2>üçΩÔ∏è Hara Hachi Bu (80% Rule)</h2>

                <form onsubmit="logMeal(event)">
                    <div class="activity-form">
                        <div class="form-group">
                            <label for="mealName">Meal *</label>
                            <input type="text" id="mealName" placeholder="Breakfast" required>
                        </div>
                        <div class="form-group">
                            <label for="mealTime">Time *</label>
                            <input type="time" id="mealTime" required>
                        </div>
                        <div class="form-group">
                            <label for="mealFood">What you ate *</label>
                            <textarea id="mealFood" placeholder="Describe..." required></textarea>
                        </div>
                        <button type="submit" class="btn-primary" style="grid-column: 1 / -1;">‚ûï Log Meal</button>
                    </div>
                </form>
                <h3>Today's Meals</h3>
                <div id="mealList" class="item-grid"></div>
            </div>
        </div>

        <!-- WELLNESS SECTION -->
        <div id="wellness" class="section">
            <div class="card">
                <h2>üí™ Wellness Tracking</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="avgSleep">0</div>
                        <div class="stat-label">Avg Sleep</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="stressScore">0</div>
                        <div class="stat-label">Stress</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="wellnessScore">0</div>
                        <div class="stat-label">Wellness %</div>
                    </div>
                </div>

                <h3>Log Sleep</h3>
                <div class="activity-form">
                    <div class="form-group">
                        <label for="sleepHours">Sleep Hours *</label>
                        <input type="number" id="sleepHours" min="0" max="12" step="0.5" placeholder="7.5" required>
                    </div>
                    <div class="form-group">
                        <label for="sleepQuality">Quality (1-10) *</label>
                        <input type="number" id="sleepQuality" min="1" max="10" placeholder="8" required>
                    </div>
                    <button class="btn-primary" onclick="logSleep()" style="grid-column: 1 / -1;">‚ûï Log Sleep</button>
                </div>

                <h3 style="margin-top: 15px;">Log Stress</h3>
                <div class="activity-form">
                    <div class="form-group">
                        <label for="stressLevel">Stress Level (1-10) *</label>
                        <input type="range" id="stressLevel" min="1" max="10" value="5">
                        <div style="color: var(--primary); font-weight: 600; margin-top: 4px;">Level: <span id="stressValue">5</span>/10</div>
                    </div>
                    <button class="btn-primary" onclick="logStress()" style="grid-column: 1 / 1;">‚ûï Log</button>
                </div>

                <div id="wellnessList" class="item-grid" style="margin-top: 15px;"></div>
            </div>
        </div>

        <!-- ANALYTICS SECTION -->
        <div id="analytics" class="section">
            <div class="card">
                <h2>üìä Your Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="totalActivities">0</div>
                        <div class="stat-label">Activities Today</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="totalMinutes">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="avgFlow">0</div>
                        <div class="stat-label">Avg Flow</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="mealsLogged">0</div>
                        <div class="stat-label">Meals</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-secondary" onclick="exportData()">üíæ Export All Data</button>
                    <button class="btn-secondary" onclick="generateReport()">üìÑ Weekly Report</button>
                    <button class="btn-secondary" onclick="clearAllData()">üóëÔ∏è Clear Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeSettings()">‚úï</button>
            <h2 style="margin-bottom: 15px;">‚öôÔ∏è Settings</h2>
            
            <h3 style="margin-top: 15px;">Theme</h3>
            <div class="activity-form">
                <button class="btn-secondary" onclick="setTheme('light'); closeSettings()">‚òÄÔ∏è Light Mode</button>
                <button class="btn-secondary" onclick="setTheme('dark'); closeSettings()">üåô Dark Mode</button>
            </div>

            <h3 style="margin-top: 15px;">Data</h3>
            <div class="activity-form">
                <button class="btn-secondary" onclick="exportData(); closeSettings()">üíæ Export Data</button>
                <button class="btn-secondary" onclick="clearAllData(); closeSettings()">üóëÔ∏è Clear All</button>
            </div>

            <h3 style="margin-top: 15px;">About</h3>
            <p style="color: var(--text-light); font-size: 0.9em;">
                <strong>Ikigai Journey v2.0</strong><br>
                Find your purpose and live well<br>
                Based on Japanese longevity principles
            </p>
        </div>
    </div>

    <script>
        let activities = JSON.parse(localStorage.getItem('activities')) || [];
        let meals = JSON.parse(localStorage.getItem('meals')) || [];
        let ikigaiData = JSON.parse(localStorage.getItem('ikigaiData')) || null;
        let wellnessData = JSON.parse(localStorage.getItem('wellnessData')) || [];
        let theme = localStorage.getItem('theme') || 'light';

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(() => console.log('‚úÖ Service Worker registered'))
                    .catch(err => console.log('SW failed:', err));
            });
        }

        // Initialize
        window.addEventListener('load', () => {
            setTheme(theme);
            renderActivities();
            renderMeals();
            updateAnalytics();
            updateWellness();

            document.getElementById('stressLevel').addEventListener('change', (e) => {
                document.getElementById('stressValue').textContent = e.target.value;
            });

            if (ikigaiData) {
                document.getElementById('ikigaiDiagram').style.display = 'block';
                document.getElementById('resultText').innerHTML = `
                    <strong>‚ù§Ô∏è Passion:</strong> ${ikigaiData.love}<br>
                    <strong>‚≠ê Talent:</strong> ${ikigaiData.good}<br>
                    <strong>üåç Mission:</strong> ${ikigaiData.need}<br>
                    <strong>üíº Vocation:</strong> ${ikigaiData.paid}
                `;
            }
        });

        // THEME MANAGEMENT
        function setTheme(themeName) {
            theme = themeName;
            localStorage.setItem('theme', themeName);
            if (themeName === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // SETTINGS MODAL
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // EXPORT DATA
        function exportData() {
            const data = {
                ikigai: ikigaiData,
                activities: activities,
                meals: meals,
                wellness: wellnessData,
                exportDate: new Date().toLocaleString()
            };

            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ikigai-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Data exported successfully!');
        }

        // GENERATE REPORT
        function generateReport() {
            const lastWeek = new Date(new Date().getTime() - 7*24*60*60*1000).toDateString();
            const weekActivities = activities.filter(a => new Date(a.date) >= new Date(lastWeek));

            let report = `IKIGAI JOURNEY - WEEKLY REPORT\n`;
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            report += `IKIGAI PROFILE:\n`;
            if (ikigaiData) {
                report += `‚ù§Ô∏è Passion: ${ikigaiData.love}\n`;
                report += `‚≠ê Talent: ${ikigaiData.good}\n`;
                report += `üåç Mission: ${ikigaiData.need}\n`;
                report += `üíº Vocation: ${ikigaiData.paid}\n\n`;
            }
            report += `WEEKLY STATS:\n`;
            report += `Activities: ${weekActivities.length}\n`;
            report += `Total Minutes: ${weekActivities.reduce((sum, a) => sum + a.duration, 0)}\n`;
            report += `Avg Flow State: ${(weekActivities.reduce((sum, a) => sum + a.flowState, 0) / (weekActivities.length || 1)).toFixed(1)}\n`;

            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ikigai-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Report generated!');
        }

        // SHARE ON SOCIAL MEDIA
        function shareIkigai() {
            document.getElementById('shareButtons').style.display = 'flex';
        }

        function shareOnTwitter() {
            const text = `I just discovered my Ikigai! üå∏\n‚ù§Ô∏è Passion: ${ikigaiData.love}\n‚≠ê Talent: ${ikigaiData.good}\nüåç Mission: ${ikigaiData.need}\nüíº Vocation: ${ikigaiData.paid}\n\nFind yours: ${window.location.href}`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareOnFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=I%20just%20discovered%20my%20Ikigai!`;
            window.open(url, '_blank');
        }

        function shareOnLinkedIn() {
            const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }

        function shareOnWhatsApp() {
            const text = `I just discovered my Ikigai on Ikigai Journey! Find yours: ${window.location.href}`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function downloadIkigai() {
            if (!ikigaiData) {
                alert('Please discover your ikigai first!');
                return;
            }

            const text = `MY IKIGAI\n\n‚ù§Ô∏è What I Love:\n${ikigaiData.love}\n\n‚≠ê What I'm Good At:\n${ikigaiData.good}\n\nüåç What the World Needs:\n${ikigaiData.need}\n\nüí∞ What I Can Be Paid For:\n${ikigaiData.paid}`;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-ikigai.txt';
            a.click();
            URL.revokeObjectURL(url);
            alert('‚úÖ Ikigai downloaded!');
        }

        // CLEAR DATA
        function clearAllData() {
            if (confirm('Are you sure? This will delete ALL your data!')) {
                localStorage.clear();
                activities = [];
                meals = [];
                ikigaiData = null;
                wellnessData = [];
                location.reload();
            }
        }

        // SUBMIT IKIGAI
        function submitIkigai(event) {
            event.preventDefault();
            const love = document.getElementById('love').value;
            const good = document.getElementById('good').value;
            const need = document.getElementById('need').value;
            const paid = document.getElementById('paid').value;

            ikigaiData = { love, good, need, paid, timestamp: new Date() };
            localStorage.setItem('ikigaiData', JSON.stringify(ikigaiData));

            document.getElementById('resultText').innerHTML = `
                <strong>‚ù§Ô∏è Passion:</strong> ${love}<br>
                <strong>‚≠ê Talent:</strong> ${good}<br>
                <strong>üåç Mission:</strong> ${need}<br>
                <strong>üíº Vocation:</strong> ${paid}
            `;

            document.getElementById('ikigaiDiagram').style.display = 'block';
            document.getElementById('ikigaiForm').reset();
            alert('‚úÖ Ikigai saved!');
        }

        // ADD ACTIVITY
        function addActivity() {
            const name = document.getElementById('activityName').value;
            const category = document.getElementById('ikigaiCategory').value;
            const duration = document.getElementById('duration').value;
            const flowState = document.getElementById('flowState').value;

            if (!name || !category || !duration || !flowState) {
                alert('Fill all fields!');
                return;
            }

            activities.push({
                id: Date.now(),
                name, category,
                duration: parseInt(duration),
                flowState: parseInt(flowState),
                time: new Date().toLocaleTimeString(),
                date: new Date().toDateString()
            });

            localStorage.setItem('activities', JSON.stringify(activities));
            renderActivities();
            updateAnalytics();
            document.getElementById('activityName').value = '';
            document.getElementById('ikigaiCategory').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('flowState').value = '';
            alert('‚úÖ Activity logged!');
        }

        function renderActivities() {
            const today = new Date().toDateString();
            const todaysActivities = activities.filter(a => a.date === today);

            document.getElementById('activityList').innerHTML = todaysActivities.length === 0
                ? '<p style="grid-column: 1/-1; text-align: center; color: var(--text-light);">No activities logged</p>'
                : todaysActivities.map(a => `
                    <div class="item-card">
                        <div class="item-name">${a.name}</div>
                        <div class="item-meta">‚è±Ô∏è ${a.duration}min | üéØ Flow: ${a.flowState}/10</div>
                    </div>
                `).join('');
        }

        // LOG MEAL
        function logMeal(event) {
            event.preventDefault();
            const name = document.getElementById('mealName').value;
            const time = document.getElementById('mealTime').value;
            const food = document.getElementById('mealFood').value;

            if (!name || !time || !food) {
                alert('Fill all fields!');
                return;
            }

            meals.push({
                id: Date.now(),
                name, time, food,
                date: new Date().toDateString()
            });

            localStorage.setItem('meals', JSON.stringify(meals));
            renderMeals();
            updateAnalytics();
            document.getElementById('mealName').value = '';
            document.getElementById('mealTime').value = '';
            document.getElementById('mealFood').value = '';
            alert('‚úÖ Meal logged! Hara Hachi Bu! üçΩÔ∏è');
        }

        function renderMeals() {
            const today = new Date().toDateString();
            const todaysMeals = meals.filter(m => m.date === today);

            document.getElementById('mealList').innerHTML = todaysMeals.length === 0
                ? '<p style="grid-column: 1/-1; text-align: center; color: var(--text-light);">No meals logged</p>'
                : todaysMeals.map(m => `
                    <div class="item-card">
                        <div class="item-name">üçΩÔ∏è ${m.name}</div>
                        <div class="item-meta">${m.time} - ${m.food}</div>
                    </div>
                `).join('');
        }

        // LOG SLEEP
        function logSleep() {
            const hours = parseFloat(document.getElementById('sleepHours').value);
            const quality = parseInt(document.getElementById('sleepQuality').value);

            if (!hours || !quality) {
                alert('Fill all fields!');
                return;
            }

            wellnessData.push({
                id: Date.now(),
                type: 'sleep',
                hours, quality,
                date: new Date().toDateString()
            });

            localStorage.setItem('wellnessData', JSON.stringify(wellnessData));
            updateWellness();
            document.getElementById('sleepHours').value = '';
            document.getElementById('sleepQuality').value = '';
            alert('‚úÖ Sleep logged!');
        }

        // LOG STRESS
        function logStress() {
            const level = parseInt(document.getElementById('stressLevel').value);

            wellnessData.push({
                id: Date.now(),
                type: 'stress',
                level,
                date: new Date().toDateString()
            });

            localStorage.setItem('wellnessData', JSON.stringify(wellnessData));
            updateWellness();
            alert('‚úÖ Stress logged!');
        }

        function updateWellness() {
            const today = new Date().toDateString();
            const todaysWellness = wellnessData.filter(w => w.date === today);
            const sleepData = todaysWellness.filter(w => w.type === 'sleep');
            const stressData = todaysWellness.filter(w => w.type === 'stress');

            const avgSleep = sleepData.length > 0
                ? (sleepData.reduce((sum, w) => sum + w.hours, 0) / sleepData.length).toFixed(1)
                : 0;

            const avgStress = stressData.length > 0
                ? Math.round(stressData.reduce((sum, w) => sum + w.level, 0) / stressData.length)
                : 0;

            let score = 50;
            if (avgSleep >= 7 && avgSleep <= 9) score += 25;
            if (avgStress <= 4) score += 15;
            score = Math.min(100, score);

            document.getElementById('avgSleep').textContent = avgSleep;
            document.getElementById('stressScore').textContent = avgStress;
            document.getElementById('wellnessScore').textContent = score;

            document.getElementById('wellnessList').innerHTML = todaysWellness.length === 0
                ? '<p style="grid-column: 1/-1; text-align: center; color: var(--text-light);">No data logged</p>'
                : todaysWellness.map(w => `
                    <div class="item-card">
                        <div class="item-name">${w.type === 'sleep' ? 'üò¥ Sleep' : 'üòå Stress'}</div>
                        <div class="item-meta">${w.type === 'sleep' ? `${w.hours}h | Quality: ${w.quality}/10` : `Level: ${w.level}/10`}</div>
                    </div>
                `).join('');
        }

        function updateAnalytics() {
            const today = new Date().toDateString();
            const todaysActivities = activities.filter(a => a.date === today);
            const todaysMeals = meals.filter(m => m.date === today);

            const totalMinutes = todaysActivities.reduce((sum, a) => sum + a.duration, 0);
            const avgFlow = todaysActivities.length > 0
                ? (todaysActivities.reduce((sum, a) => sum + a.flowState, 0) / todaysActivities.length).toFixed(1)
                : 0;

            document.getElementById('totalActivities').textContent = todaysActivities.length;
            document.getElementById('totalMinutes').textContent = totalMinutes;
            document.getElementById('avgFlow').textContent = avgFlow;
            document.getElementById('mealsLogged').textContent = todaysMeals.length;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('settingsModal');
            if (e.target === modal) {
                closeSettings();
            }
        });
    </script>
</body>
</html>
